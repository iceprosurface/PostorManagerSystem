"use strict";!function(n){var t=n.module("appModule",["ngRoute"],["$httpProvider",function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var e=function r(n){var t,e,o,i,a,d,l,c="";for(t in n)if(e=n[t],e instanceof Array)for(l=0;l<e.length;++l)a=e[l],o=t+"["+l+"]",d={},d[o]=a,c+=r(d)+"&";else if(e instanceof Object)for(i in e)a=e[i],o=t+"["+i+"]",d={},d[o]=a,c+=r(d)+"&";else void 0!==e&&null!==e&&(c+=encodeURIComponent(t)+"="+encodeURIComponent(e)+"&");return c.length?c.substr(0,c.length-1):c};t.defaults.transformRequest=[function(t){return n.isObject(t)&&"[object File]"!==String(t)?e(t):t}]}]);t.factory("ipcService",["$http","$q",function(n,t){return{positions:function(t){return t=isNaN(parseInt(t))?1:parseInt(t),n.post("/api/admin/query",{field:["positionId","haveProduct"],from:"positions",pagination:35,page:t})},positionPages:function(){return n.post("/api/admin/maxPages",{pagination:35})},unnoticedOrders:function(t){return n.post("/api/admin/query",{where:[{key:"haveNoticed",value:0}],field:["orderId","usrPhoneNumber"],from:"orders",pagination:20,page:t})},order:function(t){return n.post("/api/admin/query",{where:[{key:"orderId",value:t}],field:["orderId","usrPhoneNumber","orderInfo","usrId","positionId","importTime","exportTime"],from:"orders"})},usr:function(t){return n.post("/api/admin/query",{where:[{key:"name",value:t}],field:["id","phoneNumber","psw","lastIp","name","email","lastLogin"],from:"usr"})},editUsr:function(t){return n.post("/api/admin/editUsr",{usr:t})},editOrder:function(t){return n.post("/api/admin/editOrder",{order:t})},adminName:function(){return n.post("/api/admin/getRootName",{})}}}]),t.config(["$routeProvider",function(n){n.when("/",{controller:"IndexController",templateUrl:"/tpl/admin/index.html"}).when("/index",{controller:"IndexController",templateUrl:"/tpl/admin/index.html"}).when("/containerStatus",{controller:"containerStatusController",templateUrl:"/tpl/admin/containerStatus.html"}).when("/unnoticed",{controller:"unnoticedController",templateUrl:"/tpl/admin/unnoticed.html"}).when("/backOrder",{controller:"backOrderController",templateUrl:"/tpl/admin/backOrder.html"}).when("/usrStatus",{controller:"usrStatusController",templateUrl:"/tpl/admin/usrStatus.html"}).when("/usrOrder",{controller:"usrOrderController",templateUrl:"/tpl/admin/usrOrder.html"}).when("/orderConf",{controller:"orderConfController",templateUrl:"/tpl/admin/orderConf.html"})}]);t.controller("containerStatusController",["$scope","ipcService",function(n,t){n.nowPage="1",n.onloading=!0;var e=function(){n.onloading=!0,t.positions(n.nowPage).then(function(t){n.positions=t.data.list,n.positions.unshift({})}),t.positionPages().then(function(t){for(var e=[],r=1;r<=parseInt(t.data);r++)e.push({id:r}),n.onloading=!1;n.pages=e})};n.$watch("nowPage",e)}]),t.controller("msgController",["$scope","ipcService",function(n,t){n.username="root",t.adminName().then(function(t){n.username=t.data.name})}]),t.controller("unnoticedController",["$scope","ipcService",function(n,t){n.datahave=!1,n.onloading=!0,n.nowPage="1";var e=function(){n.onloading=!0,t.unnoticedOrders(n.nowPage).then(function(t){n.onloading=!1,n.unnoticedOrders=t.data.list,n.unnoticedOrders&&(n.datahave=parseInt(n.unnoticedOrders.length)>0)})};n.$watch("nowPage",e)}]),t.controller("backOrderController",["$scope",function(n){}]),t.controller("usrStatusController",["$scope","ipcService",function(n,t){n.datahave=!1;var e=function(){t.usr(n.usrid).then(function(t){n.usr=t.data.list[0],n.datahave=parseInt(t.data.list.length)>0})};n.$watch("usrid",function(n){var t=/\b\w{6,12}\b/g;n&&null!==n.toString().match(t)&&e()}),n.confirm=function(){t.editUsr(n.usr).then(function(t){alert("success"),n.datahave=!1},function(){alert("false,you may need a second try")})}}]),t.controller("usrOrderController",["$scope","ipcService","$http",function(n,t,e){n.orderid="",n.datahave=!1,n.onloading=!0;var r=function(){n.onloading=!0,t.order(n.orderid).then(function(t){n.onloading=!1,n.order=t.data.list[0],n.order?n.datahave=t.data.list[0]:n.datahave=!1})};n.$watch("orderid",function(t){var e=/\b\d{12,20}\b/g;null!==t.toString().match(e)?r():n.onloading=!1}),n.confirm=function(){t.editOrder(n.order).then(function(t){alert("success"),n.datahave=!1},function(){alert("false,you may need a second try")})}}]),t.controller("orderConfController",["$scope","ipcService","$http",function(n,t,e){n.datahave=!1;var r=function(){t.order(n.orderid).then(function(t){t.data.list?n.datahave=parseInt(t.data.list.length)>0:n.datahave=!1,n.order=t.data.list[0]})};r(),n.$watch("orderid",r)}]),t.controller("IndexController",["$scope",function(n){}]);t.directive("edit",["$document",function(n){return{restrict:"AE",scope:{edata:"="},template:'<div ng-show="isEditing"><div class="input-control"><input class="input" ng-model="edata"></div><button ng-click="confirm()" class="button primary">确认</button></div><div ng-click="edit()" ng-hide="isEditing">编辑</div>',link:function(n,t,e,r){n.edit=function(){n.isEditing=!0},n.confirm=function(){n.isEditing=!1}}}}])}(angular);